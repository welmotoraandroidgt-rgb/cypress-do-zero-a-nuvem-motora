# Avan√ßando no uso do Cypress

Como voc√™ j√° deve ter percebido, o Cypress √© um framework de testes automatizados diferenciado.

E agora que voc√™ j√° conhece o b√°sico, vou te mostrar (algumas) funcionalidades mais avan√ßadas, s√≥ pra voc√™ "sentir um gostinho" do que mais o Cypress te deixa fazer.

## Controle o "rel√≥gio" üïê do navegador com os comandos `cy.clock()` e `cy.tick()`

Com a funcinalidade [`cy.clock()`](https://on.cypress.io/clock), voc√™ pode "congelar" üßä o rel√≥gio do navegador.

E com a funcionalidade [`cy.tick()`](https://on.cypress.io/tick), voc√™ pode avan√ßar no tempo. üïí

Veja um exemplo:

```js
it('exibe mensagem por 3 segundos', function() {
  cy.clock() // congela o rel√≥gio do navegador

  // (...) // a√ß√£o que dispara algo que exibe uma mensagem por tr√™s segundos

  // (...) // verifica√ß√£o de que a mensagem est√° vis√≠vel

  cy.tick(3000) // avan√ßa o rel√≥gio tr√™s segundos (em milissegundos). Avan√ßo este tempo para n√£o perd√™-lo esperando.

  // (...) // verifica√ß√£o de que a mensagem n√£o est√° mais vis√≠vel
})
```

### Conte√∫dos sugeridos

Em Junho de 2021, gravei um v√≠deo chamado [Como testar campos de data com Cypress](https://youtu.be/wiDOdfmuR2o), onde fiz uso da funcionalidade `cy.clock()`.

Ficou bem legal e recomendo assitir!

E em Mar√ßo de 2022, escrevi um conte√∫do chamado [Controle o rel√≥gio do navegador com Cypress](https://talkingabouttesting.com/2022/03/20/controle-o-relogio-do-navegador-com-cypress/). Fica a recomenda√ß√£o tamb√©m.

### Exerc√≠cio

Nos testes que verificam mensagens (de sucesso e erro), use as funcionalidades `cy.clock()` e `cy.tick()`, para verificar n√£o s√≥ que a mensagem aparece, mas tamb√©m que desaparece ap√≥s 3 segundos, por√©m, sem precisar esperar pelos 3 segundos (ganhando tempo na execu√ß√£o dos testes).

## lodash ([`Cypress._`](https://docs.cypress.io/api/utilities/_))

O [lodash](https://lodash.com) √© uma biblioteca famosa no mundo JavaScript, com diversas fun√ß√µes utilit√°rias.

E o legal √© que o Cypress j√° empacota o `lodash` junto com ele, atrav√©s do m√≥dulo `Cypress._`.

Algumas das minhas funcionalidades favoritas do `._` s√£o:

- [`Cypress._.times()`](https://lodash.com/docs/4.17.15#times)

> üë®‚Äçüè´ A funcionalidade `_.times()` serve para voc√™ executar uma fun√ß√£o de _callback_ um certo n√∫mero de vezes, onde o n√∫mero de vezes √© o primeiro argumento, e a fun√ß√£o de _callback_ √© o segundo.

Por exemplo:

```js
_.times(3, () => {
  console.log('Ol√° Cypress!')
}) // Isso registrar√° 'Ol√° Cypress!' tr√™s vezes no console.

```

- [`Cypress._.repeat()`](https://lodash.com/docs/4.17.15#repeat)

> üë®‚Äçüè´  A funcionalidade `_.repeat()` serve para repetir uma string um certo n√∫mero de vezes, onde o primeiro argumento √© a string a qual deseja-se repetir, e o segundo argumento √© quantas vezes tal string deve ser repetida.

Por exemplo:

```js
const repeatedText = _.repeat('lorem ipsum, ', 3)

console.log(repeatedText) // Isso registrar√° 'lorem ipsum, lorem ipsum, lorem ipsum, ' no console.
```

### Conte√∫dos sugeridos

Escrevi conte√∫dos que fazem uso de ambos os comandos `_.times()` e `_.repeat()`.

- [Como rodar um teste v√°rias vezes com Cypress para provar que ele √© est√°vel](https://talkingabouttesting.com/2021/02/06/como-rodar-um-teste-varias-vezes-com-cypress-para-provar-que-ele-e-estavel/)
- [Como ‚Äúsimular‚Äù um CTRL+V com Cypress](https://talkingabouttesting.com/2022/02/11/como-simular-um-ctrlv-com-cypress)

Recomendo a leitura.

### Exerc√≠cio extra 1

Experimente a funcionalidade `Cypress._.times()` em algum dos testes, pra entender seu uso e praticar.

> üôä Use para rodar um mesmo teste v√°rias vezes.

## Invoque atributos e m√©todos de elementos com o comando [`.invoke()`](https://on.cypress.io/invoke)

Vimos o comando `invoke` na aula [Lidando com links que abrem em outra aba](./07.md), para remover o atributo `target` de um elemento, evitando que quando clicado, a p√°gina n√£o abra em outra aba.

Dois outros usos do comando `.invoke()` que quero que voc√™ conhe√ßa s√£o:

- `.invoke('show')`
- e `.invoke('hide')`

Com o comando `.invoke('show')`, voc√™ pode for√ßar a exibi√ß√£o de um elemento HTML que est√° oculto, com `display: none;`, por exemplo.

E com o comando `.invoke('hide')`, voc√™ pode ocultar um elemento que est√° sendo exibido.

### Exerc√≠cio extra 2

1. Crie um teste chamado `exibe e oculta as mensagens de sucesso e erro usando .invoke()`
2. üôä O teste deve ter a seguinte estrutura:

```js
it('exibe e oculta as mensagens de sucesso e erro usando .invoke()', () => {
  cy.get('.success')
    .should('not.be.visible')
    .invoke('show')
    .should('be.visible')
    .and('contain', 'Mensagem enviada com sucesso.')
    .invoke('hide')
    .should('not.be.visible')
  cy.get('.error')
    .should('not.be.visible')
    .invoke('show')
    .should('be.visible')
    .and('contain', 'Valide os campos obrigat√≥rios!')
    .invoke('hide')
    .should('not.be.visible')
})

```

3. Execute o novo teste na _Cypress App_ e quando o mesmo passar, siga em frente.

### Exerc√≠cio extra 3

Voc√™ tamb√©m pode invocar (e definir) o valor de um _input_ ou √°rea de texto usando o comando `.invoke` (por exemplo, `cy.get('textarea').invoke('val', 'some-value')` .)

Portanto...

1. Crie um teste chamado `preenche o campo da √°rea de texto usando o comando invoke`.
2. O teste deve utilizar o comando `.invoke()` para preencher o campo da √°rea de texto.

> üôä `cy.get('#open-text-area').invoke('val', 'um texto qualquer')`

3. Verifique se o valor realmente persiste no campo.

> üôä `.should('have.value', 'um texto qualquer')`

4. Execute o novo teste na _Cypress App_ e quando o mesmo passar, siga em frente.

## [`cy.request()`](https://on.cypress.io/request)

Um dos maiores "poderes" do Cypress √© a capacidade de executar comandos √† n√≠vel da rede.

Conhe√ßa o comando `cy.request()`. ü¶∏üèΩ‚Äç‚ôÇÔ∏è

Com o comando `cy.request()`, voc√™ pode executar requisi√ß√µes HTTP √† n√≠vel da rede, economizando tempo na configura√ß√£o dos testes e focando no que importa quando se trata de testar atrav√©s da interface gr√°fica do usu√°rio (_GUI_).

Se desejar, voc√™ pode at√© mesmo usar o comando `cy.request()` para testar APIs [REST](https://en.wikipedia.org/wiki/REST).

### Mais conte√∫dos sugeridos

- [Como testar APIs com Cypress](https://talkingabouttesting.com/2021/02/07/como-verificar-a-estrutura-do-body-de-um-esquema-json-com-cypress/)
- [Como fazer login de forma program√°tica com Cypress](https://talkingabouttesting.com/2021/12/14/como-fazer-login-de-forma-programatica-com-cypress/)
- [cy.request vs. cy.intercept](https://dev.to/walmyrlimaesilv/cy-request-vs-cy-intercept-cmi) (conte√∫do em ingl√™s)

### Exerc√≠cio extra 4

1. Crie um teste chamado `faz uma requisi√ß√£o HTTP`
2. Tal teste deve fazer uso da funcionalidade `cy.request()`, para fazer uma requisi√ß√£o do tipo `GET`, para a seguinte URL: `https://cac-tat-v3.s3.eu-central-1.amazonaws.com/index.html`
3. Com a resposta da requisi√ß√£o, verifique que o `status` retornou `200`, o `statusText` retornou `OK` e o `body` inclui a _string_ `CAC TAT`
4. Por fim, execute o novo teste na _Cypress App_ e quando o mesmo passar, siga em frente.

> üë®‚Äçüè´ Quer saber mais sobre o comando `cy.request()`? Confira o [curso intermedi√°rio de Cypress da Escola TAT no Udemy](https://www.udemy.com/course/testes-automatizados-com-cypress-intermediario/?referralCode=F14505FB0076672E51A2).

## Mostre ao mundo o que voc√™ aprendeu

Para mostrar √† sua rede profissional o que voc√™ aprendeu at√© agora, poste o seguinte no LinkedIn.

> Estou fazendo o curso "Cypress, do Zero √† Nuvem" da escola online Talking About Testing, onde aprendi alguns recursos avan√ßados do Cypress, como `cy.clock()`, `cy.tick()` , `.invoke()`, `Cypress._` e `cy.request()`.#TalkingAboutTesting #EscolaTAT #CypressDoZeroANuvem #Cypress #CypressAvan√ßado

**Obs.:** Lembre-se de me marcar em sua postagem. [Aqui est√° meu perfil no LinkedIn](https://www.linkedin.com/in/walmyr-lima-e-silva-filho).

___

Parab√©ns! Vamos para a [li√ß√£o 13](./13.md). Tenho um √∫ltimo desafio para voc√™.
